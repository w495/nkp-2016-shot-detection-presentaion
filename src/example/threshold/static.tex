
\begin{frame}{Пороговые методы cо статическим порогом}
    \graybox{Как устроены}{
        \begin{itemize}
            \item разница соседних величин (по некоторой норме);
            \item превышения порога — <<аномалия>>.
        \end{itemize}%
    }
    \vspace{0.5em}
    \orangebox{Плюсы}{
        \begin{itemize}
            \item просты в реализации, втч аппаратной;
            \item не требовательны к ресурсам.
        \end{itemize}%
    }
    \vspace{0.5em}
    \bluebox{Минусы}{
        \begin{itemize}
            \item требуется заранее знать порог;
            \item не применимо для разных типов видео;
            \item чувствительны к случайным всплескам;
            \item ловят только краткосрочные события.
        \end{itemize}%
    }
\end{frame}

\subsubsection{Разница по модулю}

\begin{imageframe}{
    <<Дядя Стёпа~—~милиционер>>, простой порог
 }
    \includegraphics[width=12cm]
    {img/video/example/threshold/static/sad-stepa.pdf}
\end{imageframe}


\subsubsection{FFMPEG}

\begin{imageframe}{
    <<Дядя Стёпа~—~милиционер>>, определение <<сцен>> в FFMPEG
}
    \includegraphics[width=12cm]
    {img/video/example/threshold/static/ffmpeg-stepa.pdf}
    
\end{imageframe}


\subsubsection{Сравнение порогов}

\begin{imageframe}{
    <<Дядя Стёпа~—~милиционер>>, сравнение порогов
}
    \includegraphics[width=12cm]
        {img/video/example/threshold/static/both-stepa.pdf}
\end{imageframe}


\subsubsection{Чем плох статический порог}

\begin{imageframe}{Съёмка с БПЛА над побережьем Тулума (Мексика)}
    \includegraphics[width=12cm]%
        {img/video/example/threshold/static/sad-tulum.pdf}
\end{imageframe}

\begin{frame}{Чем плох статический порог}
    
    \bluebox{Что получилось:}{ 
        Для определения событий в~Съёмке с~БПЛА над~побережьем Тулума,
        порога $0.08$ не хватило.
        \begin{itemize}
            \item Все разницы кадров оказались меньше порога.
            \item События найдены не были.
        \end{itemize}
    }
    \vspace{1.5em}
    \orangebox{В чём проблема:}{
        \begin{itemize}
            \item величину порога надо знать заранее;
            \item нельзя использовать везде одну и ту же величину:
            \begin{itemize}
                \item в плавном видео — малые разницы кадров;
                \item в динамичном видео — большие разницы кадров.
            \end{itemize}
        \end{itemize}%
    }
\end{frame}


\begin{frame}{Улучшения статического порога}
    \orangebox{Проблема:}{
        \begin{itemize}
        \item большой порог для плавного видео:
            \begin{itemize}
                \item события найдены не будут;
            \end{itemize}
        \item маленький порог для динамичного видео:
            \begin{itemize}
                \item много ложных срабатываний;
            \end{itemize}
        \item если видео имеет плавные и динамичные участки:
            \begin{itemize}
                \item порог подобрать невозможно.
            \end{itemize}
        \end{itemize}
    }
    \vspace{1.5em}
    \greenbox{Решение:}{
        \begin{itemize}
            \item Учитывать «динамичность» видео:
            \begin{enumerate}
                \item Масштабировать разницы кадров:
                \begin{itemize}
                    \item нормировать по окрестности.
                \end{itemize}
                \item Учитывать среднюю величину и дисперсию.
            \end{enumerate}
        \end{itemize}
    }
\end{frame}



\begin{frame}{Масштабировать разницы кадров}


\[
    Norm_{n} = \dfrac
    {F_{t} - \min \left(  F_{t-n} \dots  F_{t} \right)}
    {\max \left( F_{t-n} \dots  F_{t} \right)
        - \min \left( F_{t-n} \dots  F_{t} \right)}
\]    
\end{frame}



\begin{frame}[fragile]{Масштабировать разницы кадров}


Для решения задачи мы разработали мета-язык на базе языка Python.

\begin{lstlisting}[language=FilterPython]
delay = DelayFilter()       # %{\cmnt Фильтр линейной задержки.}%
orig  = delay(0)            # %{\cmnt Входящий сигнал без изменения.}%
shift = ShiftSWFilter()     # %{\cmnt Сдвиг сигнала на один кадр.}%
diff = original - shift     # %{\cmnt Разница соседних кадров.}%
norm = NormFilter()         # %{\cmnt Норма сигнала.}%
modulus = ModulusFilter()   # %{\cmnt Модуль сигнала.}%

# %{\cmnt Возвращает скользящее окно размер 200 для каждого кадра}%
sw = BaseSWFilter(s=200, min_size=2)

# %{\cmnt Фильтры собирается отложено до непосредсвенного применения.}%
# %{\cmnt Оператор <<|>> означает <<конвейер>>.}%
swmax = sw | max           # %{\cmnt Максимум по окну размера 200}%
swmin = sw | min           # %{\cmnt Минимум по окну размера 200}%

# %{\cmnt Определим фильр масштабирования .}%
swnorm = (orig - swmin) / (swmax - swmin)

# %{\cmnt Результирующий фильтр}%
result_filter = norm(l=1) | diff | modulus | swnorm
\end{lstlisting}
\end{frame}





\begin{imageframe}{Съёмка с БПЛА над побережьем Тулума, 	масштабированный простой порог}
    \includegraphics[width=12cm]%
    {img/video/example/threshold/static/sad-swnorm-200-tulum.pdf}
\end{imageframe}

